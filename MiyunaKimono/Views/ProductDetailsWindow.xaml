<Window x:Class="MiyunaKimono.Views.ProductDetailsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:svc="clr-namespace:MiyunaKimono.Services"
        
        Title="Product Details" Width="1200" Height="720"
        WindowStartupLocation="CenterOwner"
        Background="White" ResizeMode="NoResize">


    <Window.Resources>
        <Style x:Key="HeroCarousel_NoDots" TargetType="{x:Type ListBox}" BasedOn="{StaticResource HeroCarousel}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ListBox}">
                        <Grid x:Name="Root">
                            <ContentPresenter x:Name="PART_SelectedPresenter"
                                              Content="{TemplateBinding SelectedItem}"
                                              ContentTemplate="{TemplateBinding ItemTemplate}"/>

                            <Button x:Name="PrevBtn"
                                    Width="48" Height="48"
                                    Style="{StaticResource ArrowButton}"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    Margin="12,0,0,0"
                                    Command="{Binding PrevHeroCommand}">
                                <Path Data="M 26,8 L 12,24 L 26,40"
                                      Stroke="White" StrokeThickness="3"
                                      StrokeStartLineCap="Round" StrokeEndLineCap="Round"/>
                            </Button>

                            <Button x:Name="NextBtn"
                                    Width="48" Height="48"
                                    Style="{StaticResource ArrowButton}"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center"
                                    Margin="0,0,12,0"
                                    Command="{Binding NextHeroCommand}">
                                <Path Data="M 22,8 L 36,24 L 22,40"
                                      Stroke="White" StrokeThickness="3"
                                      StrokeStartLineCap="Round" StrokeEndLineCap="Round"/>
                            </Button>

                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- แถวบน: Back + Code + Cart badge -->
        <Grid Grid.Row="0" Margin="0,0,24,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="140"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="140"/>
            </Grid.ColumnDefinitions>

            <!-- Back -->
            <Button Style="{StaticResource IconButtonNoHover}" Grid.Column="0"
        Width="140" Height="44" Click="Back_Click" Margin="-40,0,0,0">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center">
                    <Path Data="M 22,8 L 8,22 L 22,36"
              Stroke="#333" StrokeThickness="3"
              StrokeStartLineCap="Round" StrokeEndLineCap="Round"
              Margin="0,0,8,0"/>
                    <TextBlock Text="Back" FontWeight="SemiBold" FontSize="16" VerticalAlignment="Center"/>
                </StackPanel>
            </Button>

            <!-- Product Code (กลาง) -->
            <TextBlock Grid.Column="1" Text="{Binding Product.ProductCode}" 
                       FontSize="20" FontWeight="SemiBold" HorizontalAlignment="Center" VerticalAlignment="Center">

                <TextBlock.RenderTransform>
                    <TranslateTransform X="80" />
                </TextBlock.RenderTransform>
            </TextBlock>

            <!-- Cart with badge (ขวา) -->
            <Grid Grid.Column="2" HorizontalAlignment="Right">
                <Button Style="{StaticResource TopRightIconButton}" ToolTip="Cart" 
            Width="40" Height="40" 
            Click="OpenCart_Click">
                    <Image Source="pack://application:,,,/Assets/ic_cart.png" Width="24" Height="24"/>
                </Button>

                <Border Background="#f36" CornerRadius="8" MinWidth="16" Height="16"
            HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,4,4,0"
            Visibility="{Binding Source={x:Static svc:CartService.Instance}, Path=HasItems,
                 Converter={StaticResource BoolToVisibility}}"
            IsHitTestVisible="False">
                    <TextBlock Text="{Binding Source={x:Static svc:CartService.Instance}, Path=TotalQuantity}"
                   Foreground="White" FontSize="10" FontWeight="Bold"
                   HorizontalAlignment="Center" VerticalAlignment="Center"/>
                </Border>
            </Grid>
        </Grid>

        <!-- เนื้อหา -->
        <Grid Grid.Row="1" Margin="0,16,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="560"/>
                <ColumnDefinition Width="40"/>
                <ColumnDefinition/>
            </Grid.ColumnDefinitions>

            <!-- เลื่อนรูป (ListBox + ปุ่ม Prev/Next + จุด) -->
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <ListBox x:Name="ImageCarousel"
                     ItemsSource="{Binding ImageList}"
                     SelectedIndex="{Binding ImageIndex, Mode=TwoWay}"
                     Style="{StaticResource HeroCarousel_NoDots}"/>

                <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,8,0,0">
                    <Ellipse Width="8" Height="8" Margin="3" Fill="{Binding Dot1Brush}"/>
                    <Ellipse Width="8" Height="8" Margin="3" Fill="{Binding Dot2Brush}"/>
                    <Ellipse Width="8" Height="8" Margin="3" Fill="{Binding Dot3Brush}"/>
                </StackPanel>
            </Grid>

            <!-- ขวา: รายละเอียด -->
            <StackPanel Grid.Column="2" Margin="0,0,0,0">
                <!-- badge / ชื่อ -->
                <Border Background="#F4F4F6" CornerRadius="16" Padding="16,8" HorizontalAlignment="Left" Margin="0,0,0,12">
                    <TextBlock Text="Best selling" FontSize="16" />
                </Border>

                <TextBlock Text="{Binding Product.ProductName}" FontSize="32" FontWeight="SemiBold" Margin="0,0,0,8"/>
                <TextBlock Text="{Binding Product.Description}" TextWrapping="Wrap" Foreground="#555" Margin="0,0,0,18"/>

                <!-- Category -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,18">
                    <TextBlock Text="Category  " FontWeight="SemiBold"/>
                    <TextBlock>
                        <Run Text="#"/>
                        <Run Text="{Binding Product.Category}"/>
                        <Run Text="  Kimono"/>
                    </TextBlock>
                </StackPanel>

                <!-- ราคาปกติ (ขีดค่า) + Discount -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                    <TextBlock Text="Price  " FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding Product.Price, StringFormat={}{0:N0}}" TextDecorations="Strikethrough" Margin="0,0,6,0"/>
                    <TextBlock Text=" THB"/>
                    <TextBlock Text="   " />
                    <TextBlock Text="Discount " FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding DiscountText}"/>
                </StackPanel>

                <!-- ราคาหลังลด -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                    <TextBlock Text="Price  " FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding PriceAfterText}" FontSize="20" FontWeight="SemiBold"/>
                </StackPanel>

                <!-- สต็อก -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                    <TextBlock Text="Stock  " FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding Product.Quantity}"/>
                </StackPanel>

                <!-- Stepper + Add to cart + Heart -->
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" >
                    <!-- Stepper -->
                    <Border CornerRadius="12"
            BorderBrush="#D8D8D8"
            BorderThickness="1"
            Background="White"
            Margin="0,0,12,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="56"/>
                                <ColumnDefinition Width="70"/>
                                <ColumnDefinition Width="56"/>
                            </Grid.ColumnDefinitions>

                            <!-- - -->
                            <RepeatButton Grid.Column="0"
                          Style="{StaticResource StepperMinusButton}"
                          Content="—"
                          Interval="60"
                          Click="Decrement_Click"/>

                            <!-- จำนวน -->
                            <TextBox Grid.Column="1"
                     x:Name="QtyBox"
                     Style="{StaticResource StepperCenterBox}"
                     Text="{Binding Quantity, UpdateSourceTrigger=PropertyChanged}"/>

                            <!-- + -->
                            <RepeatButton Grid.Column="2"
                          Style="{StaticResource StepperPlusButton}"
                          Content="+"
                          Interval="60"
                          Click="Increment_Click"/>
                        </Grid>
                    </Border>


                    <!-- Add to cart -->
                    <Button Content="Add to cart" Height="44" Padding="28,0" Click="AddToCart_Click"
                            Style="{StaticResource AddToCartButton}" />

                    <!-- Heart -->
                    <ToggleButton Width="44" Height="44" Margin="10,0,0,0"
              Background="White" BorderBrush="#E9E9EC" BorderThickness="1"
              FocusVisualStyle="{x:Null}"
              IsChecked="{Binding Product.IsFavorite, Mode=TwoWay}"
              Checked="Heart_Checked" Unchecked="Heart_Unchecked">
                        <ToggleButton.Template>
                            <ControlTemplate TargetType="ToggleButton">
                                <Border Background="{TemplateBinding Background}"
                    BorderBrush="{TemplateBinding BorderBrush}"
                    BorderThickness="{TemplateBinding BorderThickness}"
                    CornerRadius="10" Padding="6">
                                    <Grid>
                                        <!-- หัวใจเส้น -->
                                        <Image x:Name="IconLine"
                           Source="pack://application:,,,/Assets/ic_heart_line.png"
                           Width="18" Height="18"/>
                                        <!-- หัวใจทึบ -->
                                        <Image x:Name="IconFill"
                           Source="pack://application:,,,/Assets/ic_heart_fill.png"
                           Width="18" Height="18"
                           Visibility="Collapsed"/>
                                    </Grid>
                                </Border>

                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsChecked" Value="True">
                                        <Setter TargetName="IconLine" Property="Visibility" Value="Collapsed"/>
                                        <Setter TargetName="IconFill" Property="Visibility" Value="Visible"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </ToggleButton.Template>
                    </ToggleButton>
                </StackPanel>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
